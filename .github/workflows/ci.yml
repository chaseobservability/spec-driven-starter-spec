name: ci
on:
  push:
  pull_request:

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate OpenAPI parses
        run: |
          python - <<'PY'
          import yaml
          yaml.safe_load(open("interfaces/api.openapi.yaml","r",encoding="utf-8"))
          print("OK openapi")
          PY

      - name: Validate JSON schemas parse
        run: |
          python - <<'PY'
          import json, glob
          for p in glob.glob("schemas/*.json"):
            json.load(open(p,"r",encoding="utf-8"))
            print("OK schema", p)
          PY

      - name: Validate flows parse
        run: |
          python - <<'PY'
          import glob, yaml
          for p in glob.glob("flows/*.yaml"):
            yaml.safe_load(open(p,"r",encoding="utf-8"))
            print("OK flow", p)
          PY

      - name: Ensure governance files exist
        run: |
          test -f ROADMAP.md
          test -f CONTRIBUTING.md
          test -f RELEASE_CHECKLIST.md
          test -f docs/ENGINEERING_GUIDELINES.md
          test -f CHANGELOG.md

      - name: Ensure harness files exist
        run: |
          test -f AGENTS.md
          test -f SDD_STARTER_PACK_CONTRACT.md
          test -f docs/index.md
          test -f docs/architecture/index.md
          test -f docs/product-specs/index.md
          test -f docs/references/index.md
          test -f docs/exec-plans/tech-debt-tracker.md
          test -d docs/exec-plans/active
          test -d docs/exec-plans/completed
